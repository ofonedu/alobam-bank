"use strict";exports.id=782,exports.ids=[782],exports.modules={61483:(e,t,r)=>{function a(e,t){if(null==e)return"N/A";let r=t||"USD";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:r,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(t){return console.warn(`Failed to format currency with code ${r}:`,t),`${r} ${e.toFixed(2)} (Format Error)`}}r.d(t,{V:()=>u,v:()=>a});let s=["John","Jane","Michael","Emily","David","Sarah","Chris","Jessica","James","Linda","Robert","Patricia","William","Jennifer","Richard","Mary","Charles","Susan","Joseph","Karen"],o=["Smith","Doe","Johnson","Williams","Brown","Davis","Miller","Wilson","Garcia","Rodriguez","Jones","Martinez","Taylor","Anderson","Thomas","Hernandez","Moore","Martin"],i=["Kenji","Sakura","Wei","Mei","Hiroshi","Yuki","Jin","Lien","Raj","Priya","Arjun","Ananya","Min-jun","Seo-yeon","Haruto","Aoi"],n=["Tanaka","Kim","Lee","Chen","Watanabe","Park","Nguyen","Singh","Gupta","Khan","Wang","Li","Zhang","Liu","Patel","Yamamoto"],c=["Hans","Sophie","Luca","Isabelle","Miguel","Clara","Pierre","Anna","Viktor","Elena","Giovanni","Maria","Jan","Eva","Liam","Olivia"],d=["M\xfcller","Dubois","Rossi","Garc\xeda","Silva","Jansen","Novak","Ivanov","Kowalski","Andersson","Schmidt","Martin","Fern\xe1ndez","Popescu"];function u(){let e,t;let r=Math.random();r<.33?(e=s,t=o):r<.66?(e=i,t=n):(e=c,t=d);let a=e[Math.floor(Math.random()*e.length)],u=t[Math.floor(Math.random()*t.length)];return`${a} ${u}`}},72189:(e,t,r)=>{r.d(t,{Lh:()=>h,ME:()=>v,Uv:()=>w,bV:()=>A,fw:()=>b,q8:()=>g,sB:()=>y,uu:()=>p,yJ:()=>I});var a=r(91199);r(42087);var s=r(20055),o=r(37036),i=r(59652),n=r(12002),c=r(7944),d=r(93587),u=r(2235),l=r(37808),m=r(30677),f=r(61483);async function p(e,t){if(!e)return{success:!1,message:"User ID is required for KYC submission."};try{let r=o.Nt.safeParse(t);if(!r.success)return{success:!1,message:"Invalid form data. Please check your inputs.",error:r.error.flatten().fieldErrors};let{fullName:a,dateOfBirth:d,address:l,governmentId:f,governmentIdPhoto:p}=r.data,g="",h="";if(!p||!p[0])return console.warn(`submitKycAction: No governmentIdPhoto provided or file is missing for user ${e}.`),{success:!1,message:"Government ID photo was not provided or is invalid. Please select a file.",error:"No photo file in form data."};{let t=p[0];h=t.name;try{console.log(`submitKycAction: Attempting to upload KYC photo for user ${e}, filename: ${t.name}, size: ${t.size}, type: ${t.type}`);let r=`kycDocuments/${e}/${Date.now()}_${t.name}`,a=(0,n.KR)(s.IG,r);console.log(`submitKycAction: Storage reference created: ${a.toString()}`);let o=await (0,n.D)(a,t);g=await (0,n.qk)(o.ref),console.log(`submitKycAction: KYC photo uploaded successfully for user ${e}. URL: ${g}`)}catch(o){let t=s.IG.app.options.storageBucket||"NOT_CONFIGURED",r=s.IG.app.options.projectId||"PROJECT_ID_NOT_CONFIGURED";console.error(`submitKycAction: Critical error uploading KYC photo to Firebase Storage for user ${e}:`),console.error("Detailed Firebase Storage Upload Error Code:",o.code),console.error("Detailed Firebase Storage Upload Error Message:",o.message),console.error("Detailed Firebase Storage Upload Error Name:",o.name),console.error("Full Firebase Storage Upload Error Object:",JSON.stringify(o,Object.getOwnPropertyNames(o)));let a=`Storage Error: ${o.code||"Unknown Code"} - ${o.message||"No specific message from storage."}. Attempted bucket: ${t} for Project ID: ${r}. Please ensure Firebase Storage is enabled and configured for this project in the Firebase Console.`;return{success:!1,message:`Failed to upload ID photo. ${a}`,error:a}}}let b=(0,i.H9)(s.db,"kycData",e),y=(0,i.H9)(s.db,"users",e),A=await (0,i.x7)(y);if(!A.exists())return{success:!1,message:"User profile not found."};let v=A.data(),w={userId:e,fullName:a,dateOfBirth:d,address:l,governmentId:f,photoUrl:g,photoFileName:h,status:"pending_review",submittedAt:i.Dc.now()};await (0,i.BN)(b,w,{merge:!0});let I={kycStatus:w.status};await (0,i.mZ)(y,I);let N=await (0,u.J$)(),D=N.settings?.platformName||"Wohana Funds",C=N.settings?.emailLogoImageUrl,x=N.settings?.supportEmail,$=w.submittedAt.toDate().toISOString(),S={fullName:a,bankName:D,emailLogoImageUrl:C,kycSubmissionDate:$,loginUrl:`${process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:9002"}/dashboard/kyc`};if(v.email)try{let e=await (0,m._)("KYC_SUBMITTED",S);e.html&&(0,m.u)({to:v.email,subject:e.subject,htmlBody:e.html,textBody:`Your KYC documents submitted on ${$} have been received and are under review. Thank you, The ${D} Team.`}).then(e=>{e.success?console.log("KYC submitted email sent to user successfully."):console.error("Failed to send KYC submitted email to user:",e.error)})}catch(e){console.error("Error preparing/sending KYC submitted email to user:",e.message)}if(x){let t={fullName:a,userId:e,bankName:D,emailLogoImageUrl:C,kycSubmissionDate:$,adminReviewUrl:`${process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:9002"}/admin/kyc`};try{let r=await (0,m._)("ADMIN_KYC_SUBMITTED",t);r.html&&(0,m.u)({to:x,subject:r.subject,htmlBody:r.html,textBody:`New KYC Submission: User ${a} (ID: ${e}) submitted KYC documents on ${$}. Review at ${t.adminReviewUrl}. - The ${D} System.`}).then(e=>{e.success?console.log("KYC submitted notification sent to admin successfully."):console.error("Failed to send KYC submitted notification to admin:",e.error)})}catch(e){console.error("Error preparing/sending KYC submitted notification to admin:",e.message)}}else console.warn("Admin/Support email not configured in platform settings. Cannot send KYC submission notification to admin.");(0,c.revalidatePath)("/dashboard/kyc"),(0,c.revalidatePath)("/dashboard");let k={userId:w.userId,fullName:w.fullName,dateOfBirth:w.dateOfBirth,address:w.address,governmentId:w.governmentId,photoUrl:w.photoUrl,photoFileName:w.photoFileName,status:w.status,submittedAt:$};return{success:!0,message:"KYC information submitted successfully. Awaiting review.",kycData:k}}catch(r){console.error("Error submitting KYC:",r);let e=s.IG.app.options.storageBucket||"NOT_CONFIGURED",t=s.IG.app.options.projectId||"PROJECT_ID_NOT_CONFIGURED";return{success:!1,message:`An unexpected error occurred during KYC submission. Attempted bucket: ${e} for Project ID: ${t}. Error: ${r.message}`,error:r.message}}}async function g(e){if(!e)return null;let t=(0,i.H9)(s.db,"kycData",e),r=await (0,i.x7)(t);if(r.exists()){let e=r.data();return{userId:e.userId,fullName:e.fullName,dateOfBirth:e.dateOfBirth,address:e.address,governmentId:e.governmentId,photoUrl:e.photoUrl,photoFileName:e.photoFileName,status:e.status,submittedAt:e.submittedAt?e.submittedAt.toDate():void 0,reviewedAt:e.reviewedAt?e.reviewedAt.toDate():void 0,reviewedBy:e.reviewedBy,rejectionReason:e.rejectionReason}}return null}async function h(e,t,r,a){if(!e)return{success:!1,message:"User ID is required for transfer."};let o=await (0,i.x7)((0,i.H9)(s.db,"users",e));if(!o.exists())return{success:!1,message:"User profile not found."};let n=o.data();if("verified"!==n.kycStatus)return{success:!1,message:"KYC verification required to perform transfers."};try{let o,l,p;let g=await (0,u.J$)(),h=a;null==h&&(h=g.settings?.cotPercentage??.01);let b=t.amount*h,y=t.amount+b,A="currency"in t&&t.currency?t.currency:n.primaryCurrency||"USD";if(g.settings?.enableOtpForTransfers&&!r.otpVerified)return{success:!1,message:"OTP verification is required for this transfer but was not completed."};if(g.settings?.requireCOTConfirmation&&r.cotCode){let t=await (0,d.PB)(r.cotCode,"COT",e);if(!t.valid||!t.codeId)return{success:!1,message:t.message||"Invalid or missing COT code."};o=t.codeId}if(g.settings?.requireIMFAuthorization&&r.imfCode){let t=await (0,d.PB)(r.imfCode,"IMF",e);if(!t.valid||!t.codeId)return{success:!1,message:t.message||"Invalid or missing IMF code."};l=t.codeId}if(g.settings?.requireTaxClearance&&r.taxCode){let t=await (0,d.PB)(r.taxCode,"TAX",e);if(!t.valid||!t.codeId)return{success:!1,message:t.message||"Invalid or missing Tax code."};p=t.codeId}let v=await (0,i.c4)(s.db,async a=>{let n=(0,i.H9)(s.db,"users",e),c=await a.get(n);if(!c.exists())throw Error("User profile not found within transaction.");let u=c.data(),m=u.balance||0;if(u.primaryCurrency===A||"currency"in t||console.warn(`Transfer currency for local transfer should match user's primary currency. Defaulting to user's primary: ${u.primaryCurrency}.`),m<y)throw Error(`Insufficient funds in your primary account (${u.primaryCurrency}) to complete the transfer including fees. Required: ${y.toFixed(2)}, Available: ${m.toFixed(2)}`);let f=parseFloat((m-y).toFixed(2));a.update(n,{balance:f});let g={};t.recipientName&&(g.name=t.recipientName),"recipientAccountNumber"in t&&t.recipientAccountNumber?g.accountNumber=t.recipientAccountNumber:"recipientAccountNumberIBAN"in t&&t.recipientAccountNumberIBAN&&(g.accountNumber=t.recipientAccountNumberIBAN),t.bankName&&(g.bankName=t.bankName),"swiftBic"in t&&t.swiftBic&&""!==t.swiftBic.trim()&&(g.swiftBic=t.swiftBic),"country"in t&&t.country&&""!==t.country.trim()&&(g.country=t.country);let h={cot:parseFloat(b.toFixed(2))};r.cotCode&&(h.cotCode=r.cotCode),r.imfCode&&(h.imfCode=r.imfCode),r.taxCode&&(h.taxCode=r.taxCode),r.otpCode&&(h.otpCode=r.otpCode),r.otpVerified&&(h.otpVerified=!0),(0,i.rJ)(s.db,"transactions");let v={userId:e,date:i.Dc.now(),description:`Transfer to ${t.recipientName}`,amount:-t.amount,type:"transfer",status:"completed",currency:A,...Object.keys(g).length>0&&{recipientDetails:g},...Object.keys(h).length>0&&{authorizationDetails:h}},w=(0,i.H9)((0,i.rJ)(s.db,"transactions"));if(a.set(w,v),b>0){let r={userId:e,date:i.Dc.now(),description:`Cost of Transfer (COT) for transaction to ${t.recipientName}`,amount:-b,type:"fee",status:"completed",currency:A,relatedTransferId:w.id},o=(0,i.H9)((0,i.rJ)(s.db,"transactions"));a.set(o,r)}let I=(0,i.wP)(s.db);return o&&await (0,d.SA)(o,I),l&&await (0,d.SA)(l,I),p&&await (0,d.SA)(p,I),{transactionId:w.id,newBalance:f,userCurrency:u.primaryCurrency||"USD",userFullName:u.displayName||"Customer",mainTransferAmount:t.amount,recipientName:t.recipientName}}),w=(0,i.wP)(s.db);if(o&&await (0,d.SA)(o,w),l&&await (0,d.SA)(l,w),p&&await (0,d.SA)(p,w),await w.commit().catch(e=>console.error("Error committing code usage batch:",e)),n.email){let e={fullName:v.userFullName,transactionAmount:(0,f.v)(v.mainTransferAmount,v.userCurrency),transactionType:"Debit - Fund Transfer",transactionDate:new Date().toISOString(),transactionId:v.transactionId,transactionDescription:`Transfer to ${v.recipientName}`,recipientName:v.recipientName,currentBalance:(0,f.v)(v.newBalance,v.userCurrency),loginUrl:`${process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:9002"}/dashboard/transactions`};try{let t=await (0,m._)("DEBIT_NOTIFICATION",e);t.html&&(0,m.u)({to:n.email,subject:t.subject,htmlBody:t.html}).then(e=>{e.success||console.error("Failed to send debit notification email:",e.error)})}catch(e){console.error("Error preparing debit notification email:",e.message)}}return(0,c.revalidatePath)("/dashboard"),(0,c.revalidatePath)("/dashboard/transactions"),(0,c.revalidatePath)("/dashboard/profile"),{success:!0,message:"Transfer processed successfully.",newBalance:v.newBalance,transactionId:v.transactionId}}catch(e){return console.error("Error recording transfer:",e),{success:!1,message:e.message||"An unexpected error occurred during transfer processing.",error:e.message}}}async function b(e,t){if(!e)return{success:!1,error:"User ID is required."};try{let r;let a=(0,i.rJ)(s.db,"transactions"),o=[(0,i._M)("userId","==",e),(0,i.My)("date","desc")];t&&t>0&&o.push((0,i.AB)(t)),r=(0,i.P)(a,...o);let n=(await (0,i.GG)(r)).docs.map(e=>{let t=e.data(),r=new Date;if(t.date&&"function"==typeof t.date.toDate)r=t.date.toDate();else if(t.date instanceof Date)r=t.date;else if(t.date)try{let a=new Date(t.date);isNaN(a.getTime())?console.warn(`Transaction document ${e.id} has an invalid date format:`,t.date):r=a}catch(r){console.warn(`Transaction document ${e.id} has an unparsable date:`,t.date,r)}else console.warn(`Transaction document ${e.id} is missing the 'date' field.`);return{id:e.id,...t,date:r}});return{success:!0,transactions:n}}catch(e){if(console.error("Error fetching user transactions (fetchUserTransactionsAction):",e.message,e.stack),"failed-precondition"===e.code&&e.message&&e.message.includes("firestore/indexes?create_composite=")){let t=e.message.match(/(https:\/\/console\.firebase\.google\.com\/project\/[^/]+\/firestore\/indexes\?create_composite=[^ ]+)/),r=t?t[0]:"Please check Firestore console for index creation instructions.",a=`Failed to fetch transactions. Firestore requires a composite index for this query. Please create it by visiting: ${r}`;return console.error(a),{success:!1,error:a}}return{success:!1,error:`Failed to fetch transactions. Server error: ${e.message}`}}}async function y(e,t){if(!e)return{success:!1,message:"User ID is required."};let r=o.vR.safeParse(t);if(!r.success)return{success:!1,message:"Invalid form data.",error:r.error.flatten().fieldErrors};let{firstName:a,lastName:n,phoneNumber:d}=r.data;try{let t=(0,i.H9)(s.db,"users",e),r={firstName:a,lastName:n,displayName:`${a} ${n}`};return void 0!==d&&(r.phoneNumber=d),await (0,i.mZ)(t,r),(0,c.revalidatePath)("/dashboard/profile"),{success:!0,message:"Profile updated successfully."}}catch(e){return console.error("Error updating user profile:",e),{success:!1,message:"Failed to update profile.",error:e.message}}}async function A(e,t){if(!e)return{success:!1,message:"User ID is required."};let r=await (0,i.x7)((0,i.H9)(s.db,"users",e));if(!r.exists())return{success:!1,message:"User profile not found."};let a=r.data();if("verified"!==a.kycStatus)return{success:!1,message:"KYC verification required to apply for a loan."};let n=o.QF.safeParse(t);if(!n.success)return{success:!1,message:"Invalid loan application data.",error:n.error.flatten().fieldErrors};try{let t=a.displayName||`${a.firstName} ${a.lastName}`.trim()||"Unknown Applicant",r=(0,i.rJ)(s.db,"loans"),o={userId:e,applicantName:t,amount:n.data.amount,termMonths:n.data.termMonths,purpose:n.data.purpose,interestRate:.08,status:"pending",applicationDate:i.Dc.now(),currency:a.primaryCurrency||"USD"},d=await (0,i.gS)(r,o);return(0,c.revalidatePath)("/dashboard/loans"),(0,c.revalidatePath)("/admin/loans"),{success:!0,message:"Loan application submitted successfully.",loanId:d.id}}catch(e){return console.error("Error submitting loan application:",e),{success:!1,message:"Failed to submit loan application.",error:e.message}}}async function v(e,t){if(!e)return{success:!1,message:"User ID is required to submit a ticket."};let r=o.$4.safeParse(t);if(!r.success)return{success:!1,message:"Invalid support ticket data.",error:r.error.flatten().fieldErrors};try{let t=(0,i.H9)(s.db,"users",e),a=await (0,i.x7)(t);if(!a.exists())return{success:!1,message:"User profile not found."};let o=a.data(),n=(0,i.rJ)(s.db,"supportTickets"),d={userId:e,userName:o.displayName||`${o.firstName} ${o.lastName}`.trim()||"N/A",userEmail:o.email||"N/A",subject:r.data.subject,message:r.data.message,status:"open",createdAt:i.Dc.now(),updatedAt:i.Dc.now(),priority:"medium",replies:[]},u=await (0,i.gS)(n,d);return(0,c.revalidatePath)("/admin/support"),(0,c.revalidatePath)("/dashboard/support"),{success:!0,message:"Support ticket submitted successfully. We'll get back to you soon.",ticketId:u.id}}catch(e){return console.error("Error submitting support ticket:",e),{success:!1,message:"Failed to submit support ticket.",error:e.message}}}async function w(e){let t=o.Ih.safeParse({email:e});if(!t.success)return{success:!1,message:"Invalid email address.",error:t.error.flatten().fieldErrors.email?.[0]||"Validation failed."};try{return await (0,l.J1)(s.j2,t.data.email),{success:!0,message:"If an account exists for this email, a password reset link has been sent."}}catch(e){return console.error("Error sending password reset email:",e),{success:!0,message:"If an account exists for this email, a password reset link has been sent."}}}async function I(e){if(!e)return{success:!1,error:"User ID is required."};try{let t=(0,i.rJ)(s.db,"supportTickets"),r=(0,i.P)(t,(0,i._M)("userId","==",e),(0,i.My)("updatedAt","desc")),a=(await (0,i.GG)(r)).docs.map(e=>{let t=e.data(),r=(Array.isArray(t.replies)?t.replies:[]).map(e=>{let t=new Date;if(e.timestamp&&e.timestamp?.toDate)t=e.timestamp.toDate();else if(e.timestamp instanceof Date)t=e.timestamp;else if(e.timestamp)try{let r=new Date(e.timestamp);isNaN(r.getTime())||(t=r)}catch(e){}return{id:e.id||(0,i.H9)((0,i.rJ)(s.db,"dummy")).id,authorId:e.authorId||"unknown_author",authorName:e.authorName||"Unknown Author",message:e.message||"[No message content]",timestamp:t,authorRole:e.authorRole}}),a=new Date;if(t.createdAt&&t.createdAt?.toDate)a=t.createdAt.toDate();else if(t.createdAt instanceof Date)a=t.createdAt;else if(t.createdAt)try{let e=new Date(t.createdAt);isNaN(e.getTime())||(a=e)}catch(e){}let o=new Date;if(t.updatedAt&&t.updatedAt?.toDate)o=t.updatedAt.toDate();else if(t.updatedAt instanceof Date)o=t.updatedAt;else if(t.updatedAt)try{let e=new Date(t.updatedAt);isNaN(e.getTime())||(o=e)}catch(e){}return{id:e.id,userId:t.userId||"",userName:t.userName||"N/A",userEmail:t.userEmail||"N/A",subject:t.subject||"No Subject",message:t.message||"No Message",status:t.status||"open",createdAt:a,updatedAt:o,priority:t.priority,replies:r}});return{success:!0,tickets:a}}catch(e){if(console.error("Error fetching user support tickets:",e),"failed-precondition"===e.code&&e.message&&e.message.includes("firestore/indexes?create_composite=")){let t=e.message.match(/(https:\/\/console\.firebase\.google\.com\/project\/[^/]+\/firestore\/indexes\?create_composite=[^ ]+)/),r=t?t[0]:"Please check Firestore console for index creation instructions.",a=`Failed to fetch support tickets. Firestore requires a composite index for this query. Please create it by visiting: ${r}`;return console.error(a),{success:!1,error:a}}return{success:!1,error:`Failed to fetch support tickets. An unexpected error occurred: ${e.message}`}}}(0,r(33331).D)([p,g,h,b,y,A,v,w,I]),(0,a.A)(p,"60f32d43ada7d2374a46b0df1d35ef084cebf5df3b",null),(0,a.A)(g,"407833468a9cea4c45f8e9d0be623cbe901a5917fd",null),(0,a.A)(h,"7881aa90a7044a180c3b3db648fd0f4b6e31e64b42",null),(0,a.A)(b,"60fb032d0a6e94593a35e425bce9ca174b108b6388",null),(0,a.A)(y,"60c6837dc61523025f7e8e8a71c2c78356a4cc4227",null),(0,a.A)(A,"60b14452f2d72ad132eb24ebf8cdfffaac0aeba994",null),(0,a.A)(v,"60b7017c32965df0f4b37f6b41e2c3384199228e56",null),(0,a.A)(w,"40025e4e4a62ac0df3f713f1de6e3d50476588d3ea",null),(0,a.A)(I,"400eb76bda365b417c30a47efd618b51d7a0d73142",null)},91821:(e,t,r)=>{r.d(t,{Fc:()=>c,TN:()=>u,XL:()=>d});var a=r(60687),s=r(43210),o=r(24224),i=r(4780);let n=(0,o.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=s.forwardRef(({className:e,variant:t,...r},s)=>(0,a.jsx)("div",{ref:s,role:"alert",className:(0,i.cn)(n({variant:t}),e),...r}));c.displayName="Alert";let d=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h5",{ref:r,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));d.displayName="AlertTitle";let u=s.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",e),...t}));u.displayName="AlertDescription"},93587:(e,t,r)=>{r.d(t,{Iv:()=>n,PB:()=>u,SA:()=>l,ay:()=>c,y:()=>d});var a=r(91199);r(42087);var s=r(20055),o=r(59652),i=r(7944);async function n(e,t){try{let r={value:Math.random().toString(36).substring(2,10).toUpperCase(),type:e,userId:t&&""!==t.trim()?t:null,createdAt:o.Dc.now(),isUsed:!1,generatedBy:"admin_system_placeholder"},a=(0,o.rJ)(s.db,"authorizationCodes"),n=await (0,o.gS)(a,r);(0,i.revalidatePath)("/admin/authorization-codes");let c={id:n.id,value:r.value,type:r.type,createdAt:r.createdAt.toDate().toISOString(),isUsed:r.isUsed,generatedBy:r.generatedBy,userId:null===r.userId?void 0:r.userId};return r.expiresAt&&(c.expiresAt=r.expiresAt.toDate().toISOString()),{success:!0,message:`${e} code generated successfully.`,code:c}}catch(e){return console.error("Error generating authorization code. Details:",e),console.error("Full Error Object:",JSON.stringify(e,Object.getOwnPropertyNames(e))),{success:!1,error:e.message||"An unknown error occurred during code generation."}}}async function c(){try{let e=(0,o.rJ)(s.db,"authorizationCodes"),t=(0,o.P)(e,(0,o.My)("createdAt","desc")),r=(await (0,o.GG)(t)).docs.map(e=>{let t,r;let a=e.data();return t=a.createdAt&&a.createdAt?.toDate?a.createdAt.toDate():a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt),a.expiresAt&&(r=a.expiresAt?.toDate?a.expiresAt.toDate():a.expiresAt instanceof Date?a.expiresAt:new Date(a.expiresAt)),{id:e.id,value:a.value,type:a.type,userId:null===a.userId?void 0:a.userId,createdAt:t.toISOString(),expiresAt:r?r.toISOString():void 0,isUsed:a.isUsed,generatedBy:a.generatedBy}});return{success:!0,codes:r}}catch(e){return console.error("Error fetching authorization codes:",e),{success:!1,error:"Failed to fetch codes."}}}async function d(e){try{let t=(0,o.H9)(s.db,"authorizationCodes",e);return await (0,o.kd)(t),(0,i.revalidatePath)("/admin/authorization-codes"),{success:!0,message:"Code deleted successfully."}}catch(e){return console.error("Error deleting authorization code:",e),{success:!1,message:"Failed to delete code.",error:e.message}}}async function u(e,t,r){try{let a=(0,o.rJ)(s.db,"authorizationCodes");if(r){let s=(0,o.P)(a,(0,o._M)("value","==",e),(0,o._M)("type","==",t),(0,o._M)("isUsed","==",!1),(0,o._M)("userId","==",r),(0,o.AB)(1)),i=await (0,o.GG)(s);if(!i.empty){let e=i.docs[0],r=e.data();if(r.expiresAt&&r.expiresAt.toMillis()<Date.now())return{valid:!1,message:`${t} code assigned to you has expired.`};return{valid:!0,codeId:e.id}}}let i=(0,o.P)(a,(0,o._M)("value","==",e),(0,o._M)("type","==",t),(0,o._M)("isUsed","==",!1),(0,o._M)("userId","==",null),(0,o.AB)(1)),n=await (0,o.GG)(i);if(!n.empty){let e=n.docs[0],r=e.data();if(r.expiresAt&&r.expiresAt.toMillis()<Date.now())return{valid:!1,message:`Global ${t} code has expired.`};return{valid:!0,codeId:e.id}}return{valid:!1,message:`Invalid or already used ${t} code, or code not found for this user.`}}catch(e){return console.error("Error validating authorization code:",e),{valid:!1,message:"Error during code validation."}}}async function l(e,t){try{let r=(0,o.H9)(s.db,"authorizationCodes",e),a={isUsed:!0,updatedAt:(0,o.O5)()};return t?t.update(r,a):await (0,o.mZ)(r,a),(0,i.revalidatePath)("/admin/authorization-codes"),console.log(`Authorization code ${e} marked as used.`),!0}catch(t){return console.error(`Error marking code ${e} as used:`,t),!1}}(0,r(33331).D)([n,c,d,u,l]),(0,a.A)(n,"607961c159c9b367a87714546db21e0a9c89f05ec3",null),(0,a.A)(c,"00fca86877d18668f92a7fd7a206255561a88ff3ab",null),(0,a.A)(d,"40e66fba43b324afc7f095ee9cf391952501f74a6c",null),(0,a.A)(u,"70595c1d3a39338d06b93ec02adff8e1c33f3717b6",null),(0,a.A)(l,"60a9776413df4e601081ca57192a904f54113bcb9a",null)}};