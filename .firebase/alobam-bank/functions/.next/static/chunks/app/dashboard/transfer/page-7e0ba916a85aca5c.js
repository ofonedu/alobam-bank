(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2477],{17759:(e,r,s)=>{"use strict";s.d(r,{C5:()=>v,MJ:()=>h,Rr:()=>j,eI:()=>f,lR:()=>p,lV:()=>o,zB:()=>u});var t=s(95155),a=s(12115),n=s(99708),i=s(62177),l=s(59434),c=s(85057);let o=i.Op,d=a.createContext({}),u=e=>{let{...r}=e;return(0,t.jsx)(d.Provider,{value:{name:r.name},children:(0,t.jsx)(i.xI,{...r})})},m=()=>{let e=a.useContext(d),r=a.useContext(x),{getFieldState:s,formState:t}=(0,i.xW)(),n=s(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=r;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},x=a.createContext({}),f=a.forwardRef((e,r)=>{let{className:s,...n}=e,i=a.useId();return(0,t.jsx)(x.Provider,{value:{id:i},children:(0,t.jsx)("div",{ref:r,className:(0,l.cn)("space-y-2",s),...n})})});f.displayName="FormItem";let p=a.forwardRef((e,r)=>{let{className:s,...a}=e,{error:n,formItemId:i}=m();return(0,t.jsx)(c.Label,{ref:r,className:(0,l.cn)(n&&"text-destructive",s),htmlFor:i,...a})});p.displayName="FormLabel";let h=a.forwardRef((e,r)=>{let{...s}=e,{error:a,formItemId:i,formDescriptionId:l,formMessageId:c}=m();return(0,t.jsx)(n.DX,{ref:r,id:i,"aria-describedby":a?"".concat(l," ").concat(c):"".concat(l),"aria-invalid":!!a,...s})});h.displayName="FormControl";let j=a.forwardRef((e,r)=>{let{className:s,...a}=e,{formDescriptionId:n}=m();return(0,t.jsx)("p",{ref:r,id:n,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});j.displayName="FormDescription";let v=a.forwardRef((e,r)=>{var s;let{className:a,children:n,...i}=e,{error:c,formMessageId:o}=m(),d=c?String(null!==(s=null==c?void 0:c.message)&&void 0!==s?s:""):n;return d?(0,t.jsx)("p",{ref:r,id:o,className:(0,l.cn)("text-sm font-medium text-destructive",a),...i,children:d}):null});v.displayName="FormMessage"},21527:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>ee});var t=s(95155),a=s(66695),n=s(12115),i=s(60704),l=s(59434);let c=i.bL,o=n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(i.B8,{ref:r,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});o.displayName=i.B8.displayName;let d=n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(i.l9,{ref:r,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});d.displayName=i.l9.displayName;let u=n.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(i.UC,{ref:r,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});u.displayName=i.UC.displayName;var m=s(90221),x=s(62177),f=s(30285),p=s(17759),h=s(62523),j=s(88539),v=s(38091),g=s(87481),y=s(28044),N=s(50172),b=s(73672),C=s(54165),w=s(85057),T=s(76570);function A(e){let{isOpen:r,onOpenChange:s,transferData:a,cotPercentage:i,onConfirm:l,onCancel:c}=e,[o,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(""),[x,p]=(0,n.useState)(null),[j,v]=(0,n.useState)({transferAmount:0,currency:"$",cot:"0.00",totalDeduction:"0.00"});(0,n.useEffect)(()=>{if(a&&r){let e=a.amount||0,r="currency"in a&&a.currency?a.currency:"$",s=e*(void 0===i?.01:i),t=e+s;v({transferAmount:e,currency:r,cot:s.toFixed(2),totalDeduction:t.toFixed(2)}),m(""),p(null)}},[a,r,i]);let g=async()=>{if(!u.trim()){p("COT Approval Code is required to proceed.");return}p(null),d(!0),await new Promise(e=>setTimeout(e,500)),l(u),d(!1)};return(0,t.jsx)(C.lG,{open:r,onOpenChange:e=>{e||o||c(),s(e)},children:(0,t.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsxs)(C.L3,{className:"flex items-center",children:[(0,t.jsx)(T.A,{className:"mr-2 h-5 w-5 text-primary"}),"Cost of Transfer (COT) Confirmation"]}),(0,t.jsx)(C.rr,{children:"Review the Cost of Transfer and enter your COT Approval Code. If you don't have a code, please contact support."})]}),a&&(0,t.jsxs)("div",{className:"space-y-3 py-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Transfer Amount:"}),(0,t.jsxs)("span",{className:"font-medium",children:[j.currency,j.transferAmount.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-muted-foreground",children:["Cost of Transfer (COT @ ",(100*i).toFixed(2),"%):"]}),(0,t.jsxs)("span",{className:"font-medium",children:[j.currency,j.cot]})]}),(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,t.jsx)("span",{children:"Total Amount to be Deducted:"}),(0,t.jsxs)("span",{children:[j.currency,j.totalDeduction]})]}),(0,t.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,t.jsx)(w.Label,{htmlFor:"cotCode",children:"COT Approval Code"}),(0,t.jsx)(h.p,{id:"cotCode",value:u,onChange:e=>m(e.target.value),placeholder:"Enter COT code",disabled:o}),x&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:x})]})]}),(0,t.jsxs)(C.Es,{className:"gap-2 sm:justify-between",children:[(0,t.jsx)(f.$,{variant:"outline",onClick:c,disabled:o,children:"Cancel Transfer"}),(0,t.jsxs)(f.$,{onClick:g,disabled:o||!u.trim(),children:[o&&(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirm & Proceed"]})]})]})})}var S=s(93576);function I(e){let{isOpen:r,onOpenChange:s,onConfirm:a,onCancel:i}=e,[l,c]=(0,n.useState)(""),[o,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{r&&(c(""),m(null))},[r]);let x=async()=>{if(l.trim().length<5){m("IMF code must be at least 5 characters long.");return}m(null),d(!0),await new Promise(e=>setTimeout(e,500)),a(l),d(!1)};return(0,t.jsx)(C.lG,{open:r,onOpenChange:s,children:(0,t.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsxs)(C.L3,{className:"flex items-center",children:[(0,t.jsx)(S.A,{className:"mr-2 h-5 w-5 text-primary"}),"IMF Authorization Required"]}),(0,t.jsx)(C.rr,{children:"Please enter your International Monetary Fund (IMF) authorization code to proceed with the transfer. If you don't have a code, please contact support."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.Label,{htmlFor:"imfCode",children:"IMF Authorization Code"}),(0,t.jsx)(h.p,{id:"imfCode",value:l,onChange:e=>c(e.target.value),placeholder:"Enter your IMF code",disabled:o}),u&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:u})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"This is a security measure to authorize large or international transactions."})]}),(0,t.jsxs)(C.Es,{className:"gap-2 sm:justify-between",children:[(0,t.jsx)(f.$,{variant:"outline",onClick:i,disabled:o,children:"Cancel Transfer"}),(0,t.jsxs)(f.$,{onClick:x,disabled:o||l.trim().length<5,children:[o&&(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Authorization"]})]})]})})}var O=s(15300);function R(e){let{isOpen:r,onOpenChange:s,onConfirm:a,onCancel:i}=e,[l,c]=(0,n.useState)(""),[o,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{r&&(c(""),m(null))},[r]);let x=async()=>{if(!l.trim()){m("Please enter your Tax Clearance code.");return}m(null),d(!0),await new Promise(e=>setTimeout(e,500)),a(l),d(!1)};return(0,t.jsx)(C.lG,{open:r,onOpenChange:s,children:(0,t.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsxs)(C.L3,{className:"flex items-center",children:[(0,t.jsx)(O.A,{className:"mr-2 h-5 w-5 text-primary"}),"Tax Clearance Required"]}),(0,t.jsx)(C.rr,{children:"Please enter your Tax Clearance code for this transaction. If you don't have a code, please contact support."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.Label,{htmlFor:"taxClearanceCode",children:"Tax Clearance Code"}),(0,t.jsx)(h.p,{id:"taxClearanceCode",value:l,onChange:e=>c(e.target.value),placeholder:"Enter Tax Clearance Code",disabled:o}),u&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:u})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"This is a regulatory requirement for certain transactions."})]}),(0,t.jsxs)(C.Es,{className:"gap-2 sm:justify-between",children:[(0,t.jsx)(f.$,{variant:"outline",onClick:i,disabled:o,children:"Cancel Transfer"}),(0,t.jsxs)(f.$,{onClick:x,disabled:o||!l.trim(),children:[o&&(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit & Finalize Transfer"]})]})]})})}var F=s(45731),P=s(34477);let k=(0,P.createServerReference)("70284503d768c4edd859a138c506320f461332c971",P.callServer,void 0,P.findSourceMapURL,"verifyOtpAction");function B(e){let{isOpen:r,onOpenChange:s,userId:a,purpose:i,emailHint:l,onOtpVerifiedSuccessfully:c,onCancel:o}=e,{toast:d}=(0,g.dj)(),[u,m]=(0,n.useState)(""),[x,p]=(0,n.useState)(!1),[j,v]=(0,n.useState)(null);(0,n.useEffect)(()=>{r&&(m(""),v(null),p(!1))},[r]);let y=async()=>{if(!u.trim()||6!==u.trim().length||!/^\d{6}$/.test(u.trim())){v("Please enter a valid 6-digit OTP.");return}v(null),p(!0);try{let e=await k(a,i,u.trim());e.success?(d({title:"OTP Verified",description:e.message}),c(u.trim()),s(!1)):(v(e.message||"OTP verification failed."),d({title:"OTP Verification Failed",description:e.message,variant:"destructive"}))}catch(e){v("An unexpected error occurred during OTP verification."),d({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{p(!1)}};return(0,t.jsx)(C.lG,{open:r,onOpenChange:e=>{e||x||o(),s(e)},children:(0,t.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsxs)(C.L3,{className:"flex items-center",children:[(0,t.jsx)(F.A,{className:"mr-2 h-5 w-5 text-primary"})," ","OTP Verification"]}),(0,t.jsxs)(C.rr,{children:["A One-Time Password (OTP) has been sent to your registered email address",l&&" (ending in ".concat(l,")"),". Please enter it below to complete your transaction."]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.Label,{htmlFor:"otpCode",children:"One-Time Password (OTP)"}),(0,t.jsx)(h.p,{id:"otpCode",value:u,onChange:e=>m(e.target.value),placeholder:"Enter 6-digit OTP",maxLength:6,disabled:x,className:"text-center tracking-[0.3em] text-lg font-mono",autoComplete:"one-time-code"}),j&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:j})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"The OTP is valid for 10 minutes. If you didn't receive it, please check your spam folder or try initiating the transfer again to resend."})]}),(0,t.jsxs)(C.Es,{className:"gap-2 sm:justify-between",children:[(0,t.jsx)(f.$,{variant:"outline",onClick:o,disabled:x,children:"Cancel Transfer"}),(0,t.jsxs)(f.$,{onClick:y,disabled:x||6!==u.trim().length,children:[x&&(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Verify & Proceed"]})]})]})})}var E=s(34684);let z=(0,P.createServerReference)("7881aa90a7044a180c3b3db648fd0f4b6e31e64b42",P.callServer,void 0,P.findSourceMapURL,"recordTransferAction");var M=s(57376);let D=(0,P.createServerReference)("78401257383341efe2e8de584ed7adf68bb1067dc8",P.callServer,void 0,P.findSourceMapURL,"generateAndSendOtpAction");var L=s(68856),J=s(8376),U=s(44558),q=s(98328),V=s(88390),$=s(91721),_=s(55166),W=s(57679),G=s(19591);let Z=e=>{let{label:r,value:s,icon:a,valueClassName:n}=e;return(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsxs)("dt",{className:"text-xs font-semibold text-muted-foreground flex items-center",children:[a,r]}),(0,t.jsx)("dd",{className:(0,l.cn)("text-sm break-words mt-0.5",n),children:null==s||""===s?"N/A":String(s)})]})};function X(e){let{isOpen:r,onOpenChange:s,receiptDetails:a}=e;if(!a)return null;let{transactionId:n,date:i,amount:c,currency:o,recipientName:d,recipientAccountNumber:u,recipientAccountNumberIBAN:m,bankName:x,swiftBic:p,country:h,transferType:j,newBalance:v,userPrimaryCurrency:g,remarks:y}=a,N=(0,l.v)(c,o),b=void 0!==v?(0,l.v)(v,g):"N/A";return(0,t.jsx)(C.lG,{open:r,onOpenChange:s,children:(0,t.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsxs)(C.L3,{className:"flex items-center text-lg",children:[(0,t.jsx)(J.A,{className:"mr-2 h-6 w-6 text-green-500"}),"Transaction Successful"]}),(0,t.jsxs)(C.rr,{children:["Your ",j.toLowerCase()," transfer has been processed."]})]}),(0,t.jsx)("div",{className:"py-4 space-y-3 max-h-[60vh] overflow-y-auto pr-2",children:(0,t.jsxs)("dl",{className:"grid grid-cols-1 gap-y-2 text-sm",children:[(0,t.jsx)(Z,{icon:(0,t.jsx)(U.A,{className:"mr-2 h-4 w-4"}),label:"Transaction ID",value:n}),(0,t.jsx)(Z,{icon:(0,t.jsx)(q.A,{className:"mr-2 h-4 w-4"}),label:"Date & Time",value:new Date(i).toLocaleString()}),(0,t.jsx)(Z,{icon:(0,t.jsx)(V.A,{className:"mr-2 h-4 w-4"}),label:"Amount Sent",value:N,valueClassName:"font-semibold text-primary"}),(0,t.jsx)(Z,{icon:(0,t.jsx)($.A,{className:"mr-2 h-4 w-4"}),label:"Recipient Name",value:d}),"Local"===j&&u&&(0,t.jsx)(Z,{icon:(0,t.jsx)(U.A,{className:"mr-2 h-4 w-4"}),label:"Recipient Account Number",value:u}),"International"===j&&m&&(0,t.jsx)(Z,{icon:(0,t.jsx)(U.A,{className:"mr-2 h-4 w-4"}),label:"Recipient IBAN/Account",value:m}),x&&(0,t.jsx)(Z,{icon:(0,t.jsx)(_.A,{className:"mr-2 h-4 w-4"}),label:"Bank Name",value:x}),"International"===j&&p&&(0,t.jsx)(Z,{icon:(0,t.jsx)(W.A,{className:"mr-2 h-4 w-4"}),label:"SWIFT/BIC Code",value:p}),"International"===j&&h&&(0,t.jsx)(Z,{icon:(0,t.jsx)(W.A,{className:"mr-2 h-4 w-4"}),label:"Recipient Country",value:h}),y&&(0,t.jsx)(Z,{icon:(0,t.jsx)(O.A,{className:"mr-2 h-4 w-4"}),label:"Remarks",value:y}),(0,t.jsx)(Z,{icon:(0,t.jsx)(G.A,{className:"mr-2 h-4 w-4"}),label:"Approx. New Balance",value:b,valueClassName:"font-semibold"})]})}),(0,t.jsx)(C.Es,{children:(0,t.jsx)(C.HM,{asChild:!0,children:(0,t.jsx)(f.$,{type:"button",variant:"default",children:"Done"})})})]})})}var H=s(55365);function Y(){var e;let{toast:r}=(0,g.dj)(),{user:s,userProfile:a,fetchUserProfile:i}=(0,E.A)(),[c,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[C,w]=(0,n.useState)({}),[T,S]=(0,n.useState)(!1),[O,F]=(0,n.useState)(!1),[P,k]=(0,n.useState)(!1),[J,U]=(0,n.useState)(!1),[q,V]=(0,n.useState)(!1),[$,_]=(0,n.useState)(null),[W,G]=(0,n.useState)(null),[Z,Y]=(0,n.useState)(!0);(0,n.useEffect)(()=>{!async function(){Y(!0);let e=await (0,M.J)();e.success&&e.settings?G(e.settings):(G({requireCOTConfirmation:!1,requireIMFAuthorization:!1,requireTaxClearance:!1,cotPercentage:.01,enableOtpForTransfers:!1}),console.error("Failed to load platform settings for transfer form:",e.error),r({title:"Warning",description:"Could not load transfer settings. Some authorization steps may behave unexpectedly.",variant:"destructive"})),Y(!1)}()},[r]);let K=(0,x.mN)({resolver:(0,m.u)(v.qw),defaultValues:{recipientName:"",recipientAccountNumber:"",bankName:"",routingNumber:"",amount:0,remarks:""}}),Q=()=>{u(null),w({}),S(!1),F(!1),k(!1),U(!1),V(!1),_(null),K.reset(),o(!1)},ee=async(e,t)=>{if(o(!1),!W||!s||!(null==a?void 0:a.email)){r({title:"Error",description:"Platform settings or user details not loaded. Cannot proceed.",variant:"destructive"}),Q();return}if(W.enableOtpForTransfers&&!t.otpVerified){u(e),o(!0);let t=await D(s.uid,"local_transfer",a.email,a.displayName||s.displayName||void 0);o(!1),t.success?S(!0):(r({title:"OTP Error",description:t.message||"Failed to send OTP.",variant:"destructive"}),Q());return}if(W.requireCOTConfirmation&&!t.cotCode){u(e),F(!0);return}if(W.requireIMFAuthorization&&!t.imfCode){u(e),k(!0);return}if(W.requireTaxClearance&&!t.taxCode){u(e),U(!0);return}et(e,t)},er=async e=>{if(!s||null===a){r({title:"Error",description:"User not loaded. Please try again.",variant:"destructive"});return}if(a.isSuspended){r({title:"Account Suspended",description:"Fund transfers are disabled for suspended accounts. Please contact support.",variant:"destructive"});return}if(Z||!W){r({title:"Please wait",description:"Transfer settings are still loading.",variant:"default"});return}o(!0),u(e),w({});let t=W.cotPercentage||.01,n=e.amount*t,i=e.amount+n;if(a.balance<i){r({title:"Insufficient Funds",description:"You do not have enough balance to cover the transfer amount (".concat((0,l.v)(e.amount,a.primaryCurrency),") and estimated fees (").concat((0,l.v)(n,a.primaryCurrency),"). Required: ").concat((0,l.v)(i,a.primaryCurrency),", Available: ").concat((0,l.v)(a.balance,a.primaryCurrency),"."),variant:"destructive"}),o(!1);return}await ee(e,{})},es=async e=>{if(U(!1),d){let r={...C,taxCode:e};w(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},et=async(e,t)=>{if(!s||!a){r({title:"Error",description:"User session lost. Please log in and try again.",variant:"destructive"}),Q();return}o(!0);let n=await z(s.uid,e,t,null==W?void 0:W.cotPercentage);n.success&&void 0!==n.newBalance&&n.transactionId?(r({title:"Transfer Initiated",description:"Local transfer to ".concat(e.recipientName," is being processed.")}),await i(s.uid),_({transactionId:n.transactionId,date:new Date,amount:e.amount,currency:a.primaryCurrency||"USD",recipientName:e.recipientName,recipientAccountNumber:e.recipientAccountNumber,bankName:e.bankName,transferType:"Local",newBalance:n.newBalance,userPrimaryCurrency:a.primaryCurrency||"USD",remarks:e.remarks}),V(!0),K.reset()):(r({title:"Transfer Failed",description:n.message||"An unexpected error occurred.",variant:"destructive"}),Q()),o(!1)},ea=()=>{r({title:"Transfer Cancelled",description:"The fund transfer process was cancelled by the user.",variant:"default"}),Q()};if(Z)return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(L.E,{className:"h-10 w-full"}),(0,t.jsx)(L.E,{className:"h-10 w-full"}),(0,t.jsx)(L.E,{className:"h-20 w-full"}),(0,t.jsx)(L.E,{className:"h-10 w-1/3"})]});let en=O||P||J||T,ei=(null==a?void 0:a.email)?"".concat(a.email.substring(0,3),"***").concat(a.email.substring(a.email.lastIndexOf("@"))):"your registered email";return(null==a?void 0:a.isSuspended)?(0,t.jsxs)(H.Fc,{variant:"destructive",className:"mt-4",children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),(0,t.jsx)(H.XL,{children:"Account Suspended"}),(0,t.jsx)(H.TN,{children:"Fund transfers are disabled because your account is suspended. Please contact support for assistance."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.lV,{...K,children:(0,t.jsxs)("form",{onSubmit:K.handleSubmit(er),className:"space-y-6",children:[(0,t.jsx)(p.zB,{control:K.control,name:"recipientName",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Full Name"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"John Doe",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"recipientAccountNumber",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Account Number"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Enter account number",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"bankName",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Bank Name (Optional)"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"e.g., City Bank",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"routingNumber",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Routing Number"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Enter 9-digit routing number",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"amount",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsxs)(p.lR,{children:["Amount to Transfer (",(null==a?void 0:a.primaryCurrency)||"USD",")"]}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{type:"number",placeholder:"0.00",...r,onChange:e=>r.onChange(parseFloat(e.target.value)||0),disabled:c||en})}),(0,t.jsxs)(p.Rr,{children:["Available balance: ",a?(0,l.v)(a.balance,a.primaryCurrency):"Loading..."]}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"remarks",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Remarks (Optional)"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(j.T,{placeholder:"e.g., Payment for services",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsxs)(f.$,{type:"submit",disabled:c||en||Z,className:"w-full sm:w-auto",children:[c&&!en?(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"}),c&&en?"Processing...":"Initiate Transfer"]})]})}),s&&d&&W&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B,{isOpen:T,onOpenChange:e=>{e||q||ea(),S(e)},userId:s.uid,purpose:"local_transfer",emailHint:ei,onOtpVerifiedSuccessfully:e=>{if(S(!1),d){let r={...C,otpCode:e,otpVerified:!0};w(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},onCancel:ea}),(0,t.jsx)(A,{isOpen:O,onOpenChange:e=>{e||q||ea(),F(e)},transferData:d,cotPercentage:null!==(e=W.cotPercentage)&&void 0!==e?e:.01,onConfirm:e=>{if(F(!1),d){let r={...C,cotCode:e};w(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},onCancel:ea}),(0,t.jsx)(I,{isOpen:P,onOpenChange:e=>{e||q||ea(),k(e)},onConfirm:e=>{if(k(!1),d){let r={...C,imfCode:e};w(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},onCancel:ea}),(0,t.jsx)(R,{isOpen:J,onOpenChange:e=>{e||q||ea(),U(e)},onConfirm:es,onCancel:ea})]}),(0,t.jsx)(X,{isOpen:q,onOpenChange:e=>{V(e),e||Q()},receiptDetails:$})]})}function K(){var e;let{toast:r}=(0,g.dj)(),{user:s,userProfile:a,fetchUserProfile:i}=(0,E.A)(),[c,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[b,C]=(0,n.useState)({}),[w,T]=(0,n.useState)(!1),[S,O]=(0,n.useState)(!1),[F,P]=(0,n.useState)(!1),[k,J]=(0,n.useState)(!1),[U,q]=(0,n.useState)(!1),[V,$]=(0,n.useState)(null),[_,G]=(0,n.useState)(null),[Z,Y]=(0,n.useState)(!0);(0,n.useEffect)(()=>{!async function(){Y(!0);let e=await (0,M.J)();e.success&&e.settings?G(e.settings):(G({requireCOTConfirmation:!1,requireIMFAuthorization:!1,requireTaxClearance:!1,cotPercentage:.01,enableOtpForTransfers:!1}),console.error("Failed to load platform settings for transfer form:",e.error),r({title:"Warning",description:"Could not load transfer settings. Some authorization steps may behave unexpectedly.",variant:"destructive"})),Y(!1)}()},[r]);let K=(0,x.mN)({resolver:(0,m.u)(v.zi),defaultValues:{recipientName:"",recipientAccountNumberIBAN:"",bankName:"",swiftBic:"",recipientBankAddress:"",country:"",amount:0,currency:"USD",remarks:""}}),Q=()=>{u(null),C({}),T(!1),O(!1),P(!1),J(!1),q(!1),$(null),K.reset(),o(!1)},ee=async(e,t)=>{if(o(!1),!_||!s||!(null==a?void 0:a.email)){r({title:"Error",description:"Platform settings or user details not loaded. Cannot proceed.",variant:"destructive"}),Q();return}if(_.enableOtpForTransfers&&!t.otpVerified){u(e),o(!0);let t=await D(s.uid,"international_transfer",a.email,a.displayName||s.displayName||void 0);o(!1),t.success?T(!0):(r({title:"OTP Error",description:t.message||"Failed to send OTP.",variant:"destructive"}),Q());return}if(_.requireCOTConfirmation&&!t.cotCode){u(e),O(!0);return}if(_.requireIMFAuthorization&&!t.imfCode){u(e),P(!0);return}if(_.requireTaxClearance&&!t.taxCode){u(e),J(!0);return}et(e,t)},er=async e=>{if(!s||null===a){r({title:"Error",description:"User not loaded. Please try again.",variant:"destructive"});return}if(a.isSuspended){r({title:"Account Suspended",description:"Fund transfers are disabled for suspended accounts. Please contact support.",variant:"destructive"});return}if(Z||!_){r({title:"Please wait",description:"Transfer settings are still loading.",variant:"default"});return}o(!0),u(e),C({});let t=_.cotPercentage||.01,n=e.amount*t,i=e.amount+n,c=e.currency||"USD";if(a.balance<i&&a.primaryCurrency===c){r({title:"Insufficient Funds",description:"You do not have enough balance (".concat((0,l.v)(a.balance,a.primaryCurrency),") to cover the transfer amount (").concat((0,l.v)(e.amount,c),") and estimated fees (").concat((0,l.v)(n,c),"). Required: ").concat((0,l.v)(i,c),"."),variant:"destructive"}),o(!1);return}a.primaryCurrency!==c&&console.warn("Currency mismatch: User's primary currency is different from transfer currency. This flow assumes a single balance field. Currency conversion logic may be needed."),await ee(e,{})},es=async e=>{if(J(!1),d){let r={...b,taxCode:e};C(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},et=async(e,t)=>{if(!s||!a){r({title:"Error",description:"User session lost. Please log in and try again.",variant:"destructive"}),Q();return}o(!0);let n=await z(s.uid,e,t,null==_?void 0:_.cotPercentage);n.success&&void 0!==n.newBalance&&n.transactionId?(r({title:"Transfer Initiated",description:"International transfer to ".concat(e.recipientName," is being processed.")}),await i(s.uid),$({transactionId:n.transactionId,date:new Date,amount:e.amount,currency:e.currency||"USD",recipientName:e.recipientName,recipientAccountNumberIBAN:e.recipientAccountNumberIBAN,bankName:e.bankName,swiftBic:e.swiftBic,country:e.country,transferType:"International",newBalance:n.newBalance,userPrimaryCurrency:a.primaryCurrency||"USD",remarks:e.remarks}),q(!0),K.reset()):(r({title:"Transfer Failed",description:n.message||"An unexpected error occurred.",variant:"destructive"}),Q()),o(!1)},ea=()=>{r({title:"Transfer Cancelled",description:"The fund transfer process was cancelled by the user.",variant:"default"}),Q()};if(Z)return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(L.E,{className:"h-10 w-full"}),(0,t.jsx)(L.E,{className:"h-10 w-full"}),(0,t.jsx)(L.E,{className:"h-20 w-full"}),(0,t.jsx)(L.E,{className:"h-10 w-1/3"})]});let en=S||F||k||w,ei=(null==a?void 0:a.email)?"".concat(a.email.substring(0,3),"***").concat(a.email.substring(a.email.lastIndexOf("@"))):"your registered email";return(null==a?void 0:a.isSuspended)?(0,t.jsxs)(H.Fc,{variant:"destructive",className:"mt-4",children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),(0,t.jsx)(H.XL,{children:"Account Suspended"}),(0,t.jsx)(H.TN,{children:"Fund transfers are disabled because your account is suspended. Please contact support for assistance."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.lV,{...K,children:(0,t.jsxs)("form",{onSubmit:K.handleSubmit(er),className:"space-y-6",children:[(0,t.jsx)(p.zB,{control:K.control,name:"recipientName",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Full Name"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"John Doe",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"recipientAccountNumberIBAN",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Account Number / IBAN"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Enter IBAN or Account Number",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"bankName",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Bank Name"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"e.g., Global Financial Services",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"swiftBic",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"SWIFT/BIC Code"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"e.g., CITIUS33XXX",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"country",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Country"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"e.g., United States",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"recipientBankAddress",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Recipient's Bank Address (Optional)"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(j.T,{placeholder:"Full address of the recipient's bank",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,t.jsx)(p.zB,{control:K.control,name:"amount",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Amount to Transfer"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{type:"number",placeholder:"0.00",...r,onChange:e=>r.onChange(parseFloat(e.target.value)||0),disabled:c||en})}),(0,t.jsxs)(p.Rr,{children:["Available balance: ",a?(0,l.v)(a.balance,a.primaryCurrency):"Loading..."]}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsx)(p.zB,{control:K.control,name:"currency",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Currency"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(h.p,{placeholder:"e.g., USD",...r,disabled:c||en})}),(0,t.jsx)(p.Rr,{children:"Specify transfer currency."}),(0,t.jsx)(p.C5,{})]})}})]}),(0,t.jsx)(p.zB,{control:K.control,name:"remarks",render:e=>{let{field:r}=e;return(0,t.jsxs)(p.eI,{children:[(0,t.jsx)(p.lR,{children:"Remarks (Optional)"}),(0,t.jsx)(p.MJ,{children:(0,t.jsx)(j.T,{placeholder:"e.g., Invoice payment",...r,disabled:c||en})}),(0,t.jsx)(p.C5,{})]})}}),(0,t.jsxs)(f.$,{type:"submit",disabled:c||en||Z,className:"w-full sm:w-auto",children:[c&&!en?(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(W.A,{className:"mr-2 h-4 w-4"}),c&&en?"Processing...":"Initiate Transfer"]})]})}),s&&d&&_&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B,{isOpen:w,onOpenChange:e=>{e||U||ea(),T(e)},userId:s.uid,purpose:"international_transfer",emailHint:ei,onOtpVerifiedSuccessfully:e=>{if(T(!1),d){let r={...b,otpCode:e,otpVerified:!0};C(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},onCancel:ea}),(0,t.jsx)(A,{isOpen:S,onOpenChange:e=>{e||U||ea(),O(e)},transferData:d,cotPercentage:null!==(e=_.cotPercentage)&&void 0!==e?e:.01,onConfirm:e=>{if(O(!1),d){let r={...b,cotCode:e};C(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},onCancel:ea}),(0,t.jsx)(I,{isOpen:F,onOpenChange:e=>{e||U||ea(),P(e)},onConfirm:e=>{if(P(!1),d){let r={...b,imfCode:e};C(r),ee(d,r)}else r({title:"Error",description:"Transfer details lost. Please start over.",variant:"destructive"}),Q()},onCancel:ea}),(0,t.jsx)(R,{isOpen:k,onOpenChange:e=>{e||U||ea(),J(e)},onConfirm:es,onCancel:ea})]}),(0,t.jsx)(X,{isOpen:U,onOpenChange:e=>{q(e),e||Q()},receiptDetails:V})]})}var Q=s(91324);function ee(){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Fund Transfer"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Securely transfer funds to local or international recipients."})]}),(0,t.jsxs)(a.Zp,{className:"shadow-lg",children:[(0,t.jsxs)(a.aR,{children:[(0,t.jsx)(a.ZB,{children:"Initiate Transfer"}),(0,t.jsx)(a.BT,{children:"Select transfer type and fill in the details below."})]}),(0,t.jsx)(a.Wu,{children:(0,t.jsxs)(c,{defaultValue:"local",className:"w-full",children:[(0,t.jsxs)(o,{className:"grid w-full grid-cols-1 sm:grid-cols-2 sm:w-auto md:w-[400px]",children:[(0,t.jsxs)(d,{value:"local",children:[(0,t.jsx)(Q.A,{className:"mr-2 h-4 w-4"}),"Local Transfer"]}),(0,t.jsxs)(d,{value:"international",children:[(0,t.jsx)(W.A,{className:"mr-2 h-4 w-4"}),"International Transfer"]})]}),(0,t.jsx)(u,{value:"local",className:"mt-6",children:(0,t.jsxs)(a.Zp,{children:[(0,t.jsxs)(a.aR,{children:[(0,t.jsx)(a.ZB,{children:"Local Recipient Details"}),(0,t.jsx)(a.BT,{children:"For transfers within the same country."})]}),(0,t.jsx)(a.Wu,{children:(0,t.jsx)(Y,{})})]})}),(0,t.jsx)(u,{value:"international",className:"mt-6",children:(0,t.jsxs)(a.Zp,{children:[(0,t.jsxs)(a.aR,{children:[(0,t.jsx)(a.ZB,{children:"International Recipient Details"}),(0,t.jsx)(a.BT,{children:"For transfers to a different country."})]}),(0,t.jsx)(a.Wu,{children:(0,t.jsx)(K,{})})]})})]})})]})]})}},54165:(e,r,s)=>{"use strict";s.d(r,{Cf:()=>x,Es:()=>p,HM:()=>u,L3:()=>h,c7:()=>f,lG:()=>c,rr:()=>j,zM:()=>o});var t=s(95155),a=s(12115),n=s(15452),i=s(25318),l=s(59434);let c=n.bL,o=n.l9,d=n.ZL,u=n.bm,m=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.hJ,{ref:r,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})});m.displayName=n.hJ.displayName;let x=a.forwardRef((e,r)=>{let{className:s,children:a,...c}=e;return(0,t.jsxs)(d,{children:[(0,t.jsx)(m,{}),(0,t.jsxs)(n.UC,{ref:r,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...c,children:[a,(0,t.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(i.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=n.UC.displayName;let f=e=>{let{className:r,...s}=e;return(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",r),...s})};f.displayName="DialogHeader";let p=e=>{let{className:r,...s}=e;return(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s})};p.displayName="DialogFooter";let h=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.hE,{ref:r,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",s),...a})});h.displayName=n.hE.displayName;let j=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(n.VY,{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});j.displayName=n.VY.displayName},68856:(e,r,s)=>{"use strict";s.d(r,{E:()=>n});var t=s(95155),a=s(59434);function n(e){let{className:r,...s}=e;return(0,t.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",r),...s})}},88539:(e,r,s)=>{"use strict";s.d(r,{T:()=>i});var t=s(95155),a=s(12115),n=s(59434);let i=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a})});i.displayName="Textarea"},93075:(e,r,s)=>{Promise.resolve().then(s.bind(s,21527))}},e=>{var r=r=>e(e.s=r);e.O(0,[2992,6073,5511,3787,4602,1263,4443,3198,9267,1975,1603,8441,1684,7358],()=>r(93075)),_N_E=e.O()}]);