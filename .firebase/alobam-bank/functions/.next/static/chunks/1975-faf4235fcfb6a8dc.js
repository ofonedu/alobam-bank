"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1975],{34684:(e,a,t)=>{t.d(a,{AuthProvider:()=>f,A:()=>h});var r=t(95155),o=t(12115),s=t(93004),n=t(56104),i=t(35317),l=t(87481),c=t(34477);let u=(0,c.createServerReference)("604312656f2004c1bcb55da4e8d649d32b089bca51",c.callServer,void 0,c.findSourceMapURL,"getEmailTemplateAndSubject"),d=(0,c.createServerReference)("4034cc97d27439f4c059c8a95b03da6fa61b86b0db",c.callServer,void 0,c.findSourceMapURL,"sendTransactionalEmail");var m=t(57376),g=t(49509);let p=(0,o.createContext)(void 0),f=e=>{let{children:a}=e,[t,c]=(0,o.useState)(null),[f,h]=(0,o.useState)(null),[y,b]=(0,o.useState)(!0),{toast:w}=(0,l.dj)(),v=async e=>{let a=(0,i.H9)(n.db,"users",e);try{let t=await (0,i.x7)(a);if(t.exists()){let a=t.data(),r="number"==typeof a.balance?a.balance:0,o=a.primaryCurrency||"USD";h({...a,uid:e,balance:r,primaryCurrency:o})}else console.warn("User profile document not found for UID: ".concat(e,". User might be new or data is missing.")),h(null)}catch(e){var t,r;h(null),"unavailable"===e.code||(null===(t=e.message)||void 0===t?void 0:t.includes("client is offline"))||(null===(r=e.message)||void 0===r?void 0:r.includes("Failed to get document because the client is offline"))?(console.warn("fetchUserProfile: Firestore client is offline or unreachable:",e.message),w({title:"Network Issue",description:"Could not load your profile details. You appear to be offline.",variant:"destructive"})):(console.error("fetchUserProfile: Error fetching user profile:",e),w({title:"Profile Error",description:"Could not load your profile details due to an unexpected error.",variant:"destructive"}))}};(0,o.useEffect)(()=>{let e=(0,s.hg)(n.j2,async e=>{b(!0),e?(c(e),await v(e.uid)):(c(null),h(null)),b(!1)});return()=>e()},[]);let U=async e=>{b(!0),console.log("signIn: Attempting Firebase sign-in for: ".concat(e.email));try{let a=(await (0,s.x9)(n.j2,e.email,e.password)).user;console.log("signIn: Firebase sign-in successful for UID: ".concat(a.uid));let t=(0,i.H9)(n.db,"users",a.uid),r=await (0,i.x7)(t),o=null;if(r.exists()){let e=r.data();o={...e,uid:a.uid,balance:"number"==typeof e.balance?e.balance:0,primaryCurrency:e.primaryCurrency||"USD"},h(o)}else console.warn("signIn: User profile document not found for UID: ".concat(a.uid," immediately after login. This is unexpected for an existing user."));return c(a),b(!1),a}catch(a){throw b(!1),console.error("signIn: Error during Firebase sign-in for ".concat(e.email,":"),a.code,a.message),a}},S=async e=>{var a,t,r,o;b(!0);let l=null;try{console.log("signUp: Attempting to create Firebase Auth user for:",e.email),l=(await (0,s.eJ)(n.j2,e.email,e.password)).user,console.log("signUp: Firebase Auth user created successfully. UID:",l.uid);let o=(0,i.H9)(n.db,"users",l.uid),p=Math.floor(1e9+9e9*Math.random()).toString(),f="".concat(e.firstName," ").concat(e.lastName),y=e.currency||"USD",w={uid:l.uid,email:l.email,firstName:e.firstName,lastName:e.lastName,displayName:f,photoURL:null,phoneNumber:e.phoneNumber||void 0,accountType:e.accountType||"user_default_type",balance:0,primaryCurrency:y,kycStatus:"not_started",role:e.email===g.env.NEXT_PUBLIC_ADMIN_EMAIL?"admin":"user",accountNumber:p,isFlagged:!1,accountHealthScore:75,profileCompletionPercentage:50,isSuspended:!1};try{console.log("signUp: Attempting to create Firestore profile for UID:",l.uid,w),await (0,i.BN)(o,w),console.log("signUp: Firestore profile created successfully for UID:",l.uid)}catch(e){if(console.error("signUp: CRITICAL - Failed to create Firestore profile for UID:",l.uid,e),l){console.warn("signUp: Attempting to delete Firebase Auth user due to Firestore profile creation failure. UID:",l.uid);try{await (0,s.hG)(l),console.log("signUp: Firebase Auth user deleted successfully after Firestore failure. UID:",l.uid)}catch(e){console.error("signUp: CRITICAL - Failed to delete Firebase Auth user after Firestore failure. Orphaned Auth user may exist. UID:",l.uid,e)}}throw e}if(h(w),c(l),b(!1),l.email){console.log("signUp: Preparing to send welcome email to: ".concat(l.email));let e=await (0,m.J)(),o={fullName:f||"Valued User",bankName:(null===(a=e.settings)||void 0===a?void 0:a.platformName)||"Wohana Funds",emailLogoImageUrl:null===(t=e.settings)||void 0===t?void 0:t.emailLogoImageUrl,accountNumber:p,loginUrl:"".concat(g.env.NEXT_PUBLIC_BASE_URL||"http://localhost:9002","/dashboard"),supportEmail:null===(r=e.settings)||void 0===r?void 0:r.supportEmail};console.log("signUp: Email payload for template:",o);try{let e=await u("WELCOME",o);e.html?(console.log('signUp: Attempting to send welcome email. Subject: "'.concat(e.subject,'"')),d({to:l.email,subject:e.subject,htmlBody:e.html,textBody:"Welcome to ".concat(o.bankName,", ").concat(o.fullName,"! Your account is ready. Account Number: ").concat(o.accountNumber,". Login at ").concat(o.loginUrl)}).then(e=>{e.success?console.log("signUp: Welcome email sent successfully to: ".concat(l.email,". Message: ").concat(e.message)):console.error("signUp: Failed to send welcome email to ".concat(l.email,": ").concat(e.message),e.error)}).catch(e=>{console.error("signUp: Exception sending welcome email to ".concat(l.email,":"),e)})):console.warn('signUp: Welcome email HTML content was null or empty for type "WELCOME".')}catch(e){console.error("signUp: Exception preparing welcome email content for ".concat(l.email,":"),e.message,JSON.stringify(e,Object.getOwnPropertyNames(e)))}}else console.warn("signUp: New user has no email, cannot send welcome email. UID:",l.uid);return l}catch(a){if(b(!1),console.error("signUp: CLIENT-SIDE CAUGHT ERROR during overall signup for:",e.email,"Error Code:",a.code,"Error Message:",a.message,"Full Error:",JSON.stringify(a,Object.getOwnPropertyNames(a))),l&&"auth/email-already-in-use"!==a.code&&!(null===(o=a.message)||void 0===o?void 0:o.includes("Firestore"))){console.warn("signUp: Attempting to delete Firebase Auth user due to an error after creation but before Firestore (or non-Firestore error). UID:",l.uid);try{await (0,s.hG)(l),console.log("signUp: Firebase Auth user deleted successfully due to post-creation error. UID:",l.uid)}catch(e){console.error("signUp: CRITICAL - Failed to delete Firebase Auth user. Orphaned Auth user may exist. UID:",l.uid,e)}}throw a}},I=async e=>{let a=n.j2.currentUser;if(!a||!a.email)return{success:!1,message:"User not authenticated or email missing."};b(!0);try{var t,r,o;let n=s.IX.credential(a.email,e.currentPassword);await (0,s.kZ)(a,n),await (0,s.f3)(a,e.newPassword),b(!1);let i=await (0,m.J)(),l={fullName:(null==f?void 0:f.displayName)||a.displayName||"Valued User",bankName:(null===(t=i.settings)||void 0===t?void 0:t.platformName)||"Wohana Funds",emailLogoImageUrl:null===(r=i.settings)||void 0===r?void 0:r.emailLogoImageUrl,loginUrl:"".concat(g.env.NEXT_PUBLIC_BASE_URL||"http://localhost:9002","/dashboard"),passwordChangedDate:new Date().toISOString(),supportEmail:null===(o=i.settings)||void 0===o?void 0:o.supportEmail};try{let e=await u("PASSWORD_CHANGED",l);e.html&&d({to:a.email,subject:e.subject,htmlBody:e.html,textBody:"Your password for ".concat(l.bankName," was successfully changed on ").concat(new Date(l.passwordChangedDate).toLocaleDateString(),". If you did not make this change, please contact support immediately.")}).then(e=>{e.success?console.log("Password changed email sent successfully."):console.error("Failed to send password changed email:",e.error)})}catch(e){console.error("Error preparing/sending password changed email:",e.message)}return{success:!0,message:"Password updated successfully."}}catch(a){b(!1);let e="Failed to change password. Please try again.";return"auth/wrong-password"===a.code?e="Incorrect current password.":"auth/weak-password"===a.code?e="The new password is too weak.":console.error("Error changing password:",a),{success:!1,message:e}}},A=async()=>{b(!0);try{await (0,s.CI)(n.j2),c(null),h(null)}catch(e){throw console.error("Error signing out:",e),w({title:"Sign Out Failed",description:"Could not sign out. Please try again.",variant:"destructive"}),e}finally{b(!1)}};return(0,r.jsx)(p.Provider,{value:{user:t,loading:y,signIn:U,signUp:S,signOut:A,changeUserPassword:I,userProfile:f,fetchUserProfile:v},children:a})},h=()=>{let e=(0,o.useContext)(p);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},56104:(e,a,t)=>{let r;t.d(a,{db:()=>m,j2:()=>d});var o=t(23915),s=t(93004),n=t(35317),i=t(90858);let l="AIzaSyDDSfTetLVLe0LwCB-070TnJCk0eL5keRg",c="alobam-bank.firebaseapp.com",u="alobam-bank";if(!l)throw Error("Firebase API Key is missing. Please ensure NEXT_PUBLIC_FIREBASE_API_KEY is set correctly in your .env file and that the development server was restarted.");if(!c)throw Error("Firebase Auth Domain is missing. Please ensure NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN is set correctly in your .env file and that the development server was restarted.");u||console.warn("Firebase Project ID (NEXT_PUBLIC_FIREBASE_PROJECT_ID) is not set. This might cause issues with some Firebase services."),r=(0,o.Dk)().length?(0,o.Sx)():(0,o.Wp)({apiKey:l,authDomain:c,projectId:u,storageBucket:"alobam-bank.firebasestorage.app",messagingSenderId:"21187336200",appId:"1:21187336200:web:83b0e0c311f5d9820219bd"});let d=(0,s.xI)(r),m=(0,n.aU)(r);(0,i.c7)(r)},57376:(e,a,t)=>{t.d(a,{J:()=>o});var r=t(34477);let o=(0,r.createServerReference)("000ba8576fdcae11f1077fd2f6107481a50b69a49c",r.callServer,void 0,r.findSourceMapURL,"getPlatformSettingsAction")},59434:(e,a,t)=>{t.d(a,{V:()=>g,cn:()=>s,v:()=>n});var r=t(52596),o=t(39688);function s(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,o.QP)((0,r.$)(a))}function n(e,a){if(null==e)return"N/A";let t=a||"USD";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch(a){return console.warn("Failed to format currency with code ".concat(t,":"),a),"".concat(t," ").concat(e.toFixed(2)," (Format Error)")}}let i=["John","Jane","Michael","Emily","David","Sarah","Chris","Jessica","James","Linda","Robert","Patricia","William","Jennifer","Richard","Mary","Charles","Susan","Joseph","Karen"],l=["Smith","Doe","Johnson","Williams","Brown","Davis","Miller","Wilson","Garcia","Rodriguez","Jones","Martinez","Taylor","Anderson","Thomas","Hernandez","Moore","Martin"],c=["Kenji","Sakura","Wei","Mei","Hiroshi","Yuki","Jin","Lien","Raj","Priya","Arjun","Ananya","Min-jun","Seo-yeon","Haruto","Aoi"],u=["Tanaka","Kim","Lee","Chen","Watanabe","Park","Nguyen","Singh","Gupta","Khan","Wang","Li","Zhang","Liu","Patel","Yamamoto"],d=["Hans","Sophie","Luca","Isabelle","Miguel","Clara","Pierre","Anna","Viktor","Elena","Giovanni","Maria","Jan","Eva","Liam","Olivia"],m=["M\xfcller","Dubois","Rossi","Garc\xeda","Silva","Jansen","Novak","Ivanov","Kowalski","Andersson","Schmidt","Martin","Fern\xe1ndez","Popescu"];function g(){let e,a;let t=Math.random();t<.33?(e=i,a=l):t<.66?(e=c,a=u):(e=d,a=m);let r=e[Math.floor(Math.random()*e.length)],o=a[Math.floor(Math.random()*a.length)];return"".concat(r," ").concat(o)}},87481:(e,a,t)=>{t.d(a,{dj:()=>m});var r=t(12115);let o=0,s=new Map,n=e=>{if(s.has(e))return;let a=setTimeout(()=>{s.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,a)},i=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},l=[],c={toasts:[]};function u(e){c=i(c,e),l.forEach(e=>{e(c)})}function d(e){let{...a}=e,t=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>u({type:"DISMISS_TOAST",toastId:t});return u({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,a]=r.useState(c);return r.useEffect(()=>(l.push(a),()=>{let e=l.indexOf(a);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}}}]);